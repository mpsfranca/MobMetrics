<div class="content hidden" id="results">
    <div class="analytics-section">
        Trace Overview<span class="tooltip"
        data-tooltip="This section is used to have an overview of the loaded traces, in a direct, objective manner and with adjustment possibilities.">
        ?</span>
    </div>

    <div class="top-bar">
        <div class="last-upload">
            {% if last_file_name %}
                <div class="last-upload">
                    {{ last_file_name }} <span class="info">(last upload)</span>
                </div>
            {% else %}
                <div class="last-upload">
                    No file uploaded yet.
                </div>
            {% endif %}
        </div>
        <div class="actions">
            <button class="action-button">Change Trace</button>
            <button class="action-button">Configure Plots</button>
            <label class="global-checkbox">
            <input type="checkbox" /> Apply Changes Globally
            </label>
        </div>
    </div>

    <div class="dashboard-container">
    <div class="new-graphs-row">
        <div class="new-graph-container">
        <div id="traceScatterPlot">
            {{ trace_plot_html|safe }}
        </div>
        </div>
        <div class="new-graph-container">
        <div id="mobilityRadarPlot">
            {{ radar_chart_html|safe }}
        </div>
        </div>
    </div>

    <div class="cards-column">
        <div class="metric-card">
        <div class="card-title">Total Number of Stay-points</div>
        <div class="card-value">{{ global_metrics.num_stay_points }}</div>
        </div>
        <div class="metric-card">
        <div class="card-title">Total Number of Contacts</div>
        <div class="card-value">{{ global_metrics.num_contacts }}</div>
        </div>
        <div class="metric-card">
        <div class="card-title">Average Journey Distance</div>
        <div class="card-value">{{ global_metrics.total_avg_journey_distance|floatformat:2 }} m</div>
        </div>
    </div>
    </div>

    <div class="analytics-section">
        Entities Analysis<span class="tooltip"
        data-tooltip="This section is responsible for carrying out an analysis of entities present in the traces, both individually and comparatively between them.">
        ?</span>
    </div>

    <div class="top-bar">
        <div class="last-upload">
            <div class="last-upload">
                Entity Id = {{ entity.entity_id }}
            </div>
        </div>
        <div class="actions">
            <button class="action-button">Change Trace</button>
            <button class="action-button">Configure Plots</button>
        </div>
    </div>

    <div class="entity-analysis-container">
    <div class="entity-list">
        <div class="entity-list-title">Entity List</div>
        <div class="entity-scroll">
        {% for entity in metrics %}
        <div class="entity-card {% if entity.entity_id == selected_entity_id %}active{% endif %}" onclick="selectEntity({{ entity.entity_id }})">
            <strong>Entity {{ entity.entity_id }}</strong><br>
            <small>Avg. Jou. Distance: {{ entity.travel_distance|floatformat:2 }} m</small><br>
            <small>Stay Points Visited: {{ entity.stay_points_visits }}</small><br>
            <small>Avg. Journey Speed: {{ entity.travel_avg_speed|floatformat:1 }} m/s</small>
        </div>
        {% endfor %}
        </div>
    </div>

    <div class="new-graph-container">
        <div id="traceOverTime">
        {{ trace_in_time_html|safe }}
        </div>
    </div>

    <div class="new-graph-container">
        <div id="travelDistanceCompare">
        {{ travel_distance_compare_plot|safe }}
        </div>
    </div>
    </div>

    <div class="analytics-section">
        Stay-points Analysis<span class="tooltip"
        data-tooltip="This section is responsible for carrying out an analysis of stay-points present in the traces, both individually and comparatively between them.">
        ?</span>
    </div>

    <div class="top-bar">
        <div class="last-upload">
            {% if last_file_name %}
                <div class="last-upload">
                    {{ last_file_name }} <span class="info">(last upload)</span>
                </div>
            {% else %}
                <div class="last-upload">
                    No file uploaded yet.
                </div>
            {% endif %}
        </div>
        <div class="actions">
            <button class="action-button">Change Trace</button>
            <button class="action-button">Configure Plots</button>
            </label>
        </div>
    </div>

    <div class="entity-analysis-container">
    <div class="entity-list">
        <div class="entity-list-title">Stay-points List</div>
        <div class="entity-scroll">
        {% for staypoint in staypoints %}
        <div class="entity-card {% if staypoint.stay_point_id == selected_staypoint_id %}active{% endif %}" onclick="selectEntity({{ staypoint.stay_point_id }})">
            <strong>Stay-point {{ staypoint.stay_point_id }}</strong><br>
            <small>Num. of Visits: {{ staypoint.num_visits|floatformat:2 }}</small><br>
            <small>Tot. Visits Time: {{ staypoint.total_visits_time|floatformat:2 }} s</small><br>
            <small>Importance Degree: {{ staypoint.importance_degree|floatformat:1 }}</small>
        </div>
        {% endfor %}
        </div>
    </div>

    <div class="new-graph-container">
        <div id="traceOverTime">
        {{ stay_point_scatter_plot|safe }}
        </div>
    </div>

    <div class="new-graph-container">
        <div id="travelDistanceCompare">
        {{ stay_point_radar_chart|safe }}
        </div>
    </div>
    </div>

    <div class="analytics-section">
        Comparative Analysis<span class="tooltip"
        data-tooltip="This section is responsible for generating different comparative graphs between traces, using known algorithms for this purpose.">
        ?</span>
    </div>

    <div class="config-section">
        <button type="button" class="button" onclick="toggleConfig()">Configure Comparative Plots</button>
        
        <div id="configForm" class="hidden" style="margin-top: 1rem;">
            <form method="post" action="{% url 'dashboard' %}">
                {% csrf_token %}
                
                <div class="form-container">
                    <div class="form-group">
                        <label for="id_PCA_n_components">PCA N Components:</label>
                        {{ analytcs_form.PCA_n_components }}
                        <span class="tooltip">?
                            <span class="tooltiptext">Number of components for PCA</span>
                        </span>
                    </div>
                    
                    <div class="form-group">
                        <label for="id_tSNE_n_components">t-SNE N Components:</label>
                        {{ analytcs_form.tSNE_n_components }}
                        <span class="tooltip">?
                            <span class="tooltiptext">Number of components for t-SNE</span>
                        </span>
                    </div>
                    
                    <div class="form-group">
                        <label for="id_tSNE_perplexity">t-SNE Perplexity:</label>
                        {{ analytcs_form.tSNE_perplexity }}
                        <span class="tooltip">?
                            <span class="tooltiptext">The perplexity is related to the number of nearest neighbors that is used in other manifold learning algorithms. Larger datasets usually require a larger perplexity. Consider selecting a value between 5 and 50. Different values can result in significantly different results. The perplexity must be less than the number of samples.</span>
                        </span>
                    </div>
                    
                    <div class="form-group">
                        <label for="id_DBSCAN_eps">DBSCAN Eps:</label>
                        {{ analytcs_form.dbscan_eps }}
                        <span class="tooltip">?
                            <span class="tooltiptext">Maximum distance between two samples for one to be considered as in the neighborhood of the other.</span>
                        </span>
                    </div>
                    
                    <div class="form-group">
                        <label for="id_DBSCAN_min_samples">DBSCAN Min Samples:</label>
                        {{ analytcs_form.dbscan_min_samples }}
                        <span class="tooltip">?
                            <span class="tooltiptext">The number of samples in a neighborhood for a point to be considered as a core point.</span>
                        </span>
                    </div>
                </div>
                <button class="button" type="submit" name="generate_graphs">Generate Graphs</button>
            </form>
            <div class="ngraphs-wrapper">
                <div class="comparative-container">
                    <h3>PCA - MetricsModel</h3>
                    <div id="pcaMetricsPlot">
                        {{ pca_metrics_plot_html|safe }}
                    </div>
                </div>

                <div class="comparative-container">
                    <h3>PCA - Explained Variance</h3>
                    <div id="pcaExplainedPlot">
                        {{ pca_explained_plot_html|safe }}
                    </div>
                </div>

                <div class="comparative-container">
                    <h3>DBSCAN - PCA MetricsModel</h3>
                    <div id="pcaDbscanMetricsPlot">
                        {{ pca_dbscan_metrics_plot_html|safe }}
                    </div>
                </div>
                
                <div class="comparative-container">
                    <h3>t-SNE - MetricsModel</h3>
                    <div id="tsneMetricsPlot">
                        {{ tsne_metrics_plot_html|safe }}
                    </div>
                </div>

                <div class="comparative-container">
                    <h3>DBSCAN - tSNE MetricsModel</h3>
                    <div id="tsneDbscanMetricsPlot">
                        {{ tsne_dbscan_metrics_plot_html|safe }}
                    </div>
                </div>
                
                <div class="comparative-container">
                    <h3>t-SNE - GlobalMetricsModel</h3>
                    <div id="tsneGlobalPlot">
                        {{ tsne_global_plot_html|safe }}
                    </div>
                </div>

                <div class="comparative-container">
                    <h3>PCA - GlobalMetricsModel</h3>
                    <div id="pcaGlobalPlot">
                        {{ pca_global_plot_html|safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="analytics-section">
        Spatial & Social Analysis<span class="tooltip"
        data-tooltip="This section is responsible for generating different comparative graphs between traces, using known algorithms for this purpose..">
        ?</span>
    </div>

    <div class="config-section">
        <button type="button" class="button" onclick="toggleConfig()">Show Contacts Distribution</button>
        <button type="button" class="button" onclick="toggleConfig()">Show Stay-points Heatmap</button>

</div>
